<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Teacher Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    h1 { text-align: center; }

    form, .section {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    input, button {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
    }

    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }

    .student-card {
      background: #e9f7ef;
      padding: 10px;
      margin: 10px 0;
      border-radius: 8px;
    }

    .student-card span {
      display: block;
    }

    .student-card button {
      margin-top: 5px;
      background-color: #28a745;
      margin-right: 10px;
    }

    .student-card button.delete {
      background-color: #dc3545;
    }

    .message {
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
    }
    .message.success { background-color: #d4edda; color: #155724; }
    .message.error { background-color: #f8d7da; color: #721c24; }

    .tab-buttons button {
      width: auto;
      margin-right: 10px;
      padding: 8px 15px;
      border-radius: 20px;
    }
    .tab-section { display: none; }
    .tab-section.active { display: block; }
  </style>
</head>
<body>
  <h1><i class="fa-solid fa-user-graduate"></i> Teacher & Student Portal</h1>

  <div id="msg-container"></div>

  <div class="section" id="register-section">
    <h2><i class="fa-solid fa-user-plus"></i> Register</h2>
    <input type="text" id="reg-name" placeholder="Name" />
    <input type="email" id="reg-email" placeholder="Email" />
    <input type="password" id="reg-password" placeholder="Password" />
    <button onclick="register()">Register</button>
  </div>

  <div class="section" id="login-section">
    <h2><i class="fa-solid fa-right-to-bracket"></i> Login</h2>
    <input type="email" id="login-email" placeholder="Email" />
    <input type="password" id="login-password" placeholder="Password" />
    <button onclick="login()">Login</button>
  </div>

  <div class="section" id="profile-section" style="display:none;">
    <h2><i class="fa-solid fa-user"></i> Profile</h2>
    <p><strong>Name:</strong> <span id="profile-name"></span></p>
    <p><strong>Email:</strong> <span id="profile-email"></span></p>
  </div>

  <div class="section" id="student-section" style="display:none;">
    <h2><i class="fa-solid fa-users"></i> Manage Students</h2>

    <div class="tab-buttons">
      <button onclick="showTab('add')">Add</button>
      <button onclick="showTab('view')">View / Modify / Delete</button>
    </div>

    <div id="tab-add" class="tab-section active">
      <input type="text" id="student-name" placeholder="Student Name">
      <input type="number" id="student-age" placeholder="Age">
      <input type="text" id="student-grade" placeholder="Grade">
      <button onclick="addStudent()">Add Student</button>
    </div>

    <div id="tab-view" class="tab-section">
      <div id="student-list"></div>
    </div>
  </div>

  <script>
    const API_BASE = "https://b64e-2405-201-e022-90ed-11c2-7e7-7689-617e.ngrok-free.app/api"; // Change if deploying
    let token = "";

    function showMessage(message, isError = false) {
      const container = document.getElementById("msg-container");
      container.innerHTML = `<div class="message ${isError ? 'error' : 'success'}">${message}</div>`;
      setTimeout(() => container.innerHTML = '', 5000);
    }

    function showTab(tab) {
      document.querySelectorAll('.tab-section').forEach(div => div.classList.remove('active'));
      document.getElementById(`tab-${tab}`).classList.add('active');
    }

    function register() {
      fetch(`${API_BASE}/register/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: document.getElementById("reg-email").value,
          name: document.getElementById("reg-name").value,
          password: document.getElementById("reg-password").value
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.token) {
          token = data.token;
          showMessage("Registration successful!");
          loadProfile();
        } else {
          showMessage("Registration failed: " + JSON.stringify(data), true);
        }
      });
    }

    function login() {
      fetch(`${API_BASE}/token/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: document.getElementById("login-email").value,
          password: document.getElementById("login-password").value
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.access) {
          token = data.access;
          showMessage("Login successful!");
          loadProfile();
        } else {
          showMessage("Login failed: " + JSON.stringify(data), true);
        }
      });
    }

    function loadProfile() {
      fetch(`${API_BASE}/profile/`, {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("profile-name").innerText = data.name;
        document.getElementById("profile-email").innerText = data.email;
        document.getElementById("profile-section").style.display = "block";
        document.getElementById("student-section").style.display = "block";
        loadStudents();
      });
    }

    function addStudent() {
      const nameInput = document.getElementById("student-name");
      const ageInput = document.getElementById("student-age");
      const gradeInput = document.getElementById("student-grade");

      fetch(`${API_BASE}/students/`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({
          name: nameInput.value,
          age: ageInput.value,
          grade: gradeInput.value
        })
      })
      .then(res => res.json())
      .then(data => {
        showMessage("Student added successfully");
        nameInput.value = "";
        ageInput.value = "";
        gradeInput.value = "";
        loadStudents();
        showTab('view');
      });
    }

    function loadStudents() {
      fetch(`${API_BASE}/students/`, {
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(res => res.json())
      .then(data => {
        const list = document.getElementById("student-list");
        list.innerHTML = "";
        data.forEach(student => {
          const div = document.createElement("div");
          div.className = "student-card";
          div.innerHTML = `
            <span><strong>Name:</strong> <input value="${student.name}" id="name-${student.id}"></span>
            <span><strong>Age:</strong> <input value="${student.age}" id="age-${student.id}"></span>
            <span><strong>Grade:</strong> <input value="${student.grade}" id="grade-${student.id}"></span>
            <button onclick="updateStudent(${student.id})">Update</button>
            <button class="delete" onclick="deleteStudent(${student.id})">Delete</button>
          `;
          list.appendChild(div);
        });
      });
    }

    function updateStudent(id) {
      const name = document.getElementById(`name-${id}`).value;
      const age = document.getElementById(`age-${id}`).value;
      const grade = document.getElementById(`grade-${id}`).value;

      fetch(`${API_BASE}/students/${id}/`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ name, age, grade })
      })
      .then(() => {
        showMessage("Student updated successfully");
        loadStudents();
      });
    }

    function deleteStudent(id) {
      fetch(`${API_BASE}/students/${id}/`, {
        method: "DELETE",
        headers: { Authorization: `Bearer ${token}` }
      })
      .then(() => {
        showMessage("Student deleted successfully");
        loadStudents();
      });
    }
  </script>
</body>
</html>
